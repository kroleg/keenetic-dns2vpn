extends layout

block content
  - const vpnOn = !!device.policy
  .row.justify-content-center
    .col-md-6.col-lg-4
      .text-center.mb-4
        h2.mb-3
          if vpnOn
            span.text-success ON
          else
            span.text-muted OFF
        p.text-muted= device.name

      if error
        .alert.alert-danger= error

      .d-grid.gap-2
        button.btn.btn-lg(
          type="button"
          class=(vpnOn ? 'btn-outline-secondary' : 'btn-secondary active')
          onclick="selectPolicy('')"
          disabled=!vpnOn
        ) Off

        each policy in policies
          button.btn.btn-lg(
            type="button"
            class=(device.policy === policy.id ? 'btn-primary active' : 'btn-outline-primary')
            onclick=`selectPolicy('${policy.id}')`
            disabled=(device.policy === policy.id)
          )= policy.description || policy.name

      form#policyForm(method="POST" action="/set-policy")
        input#policyInput(type="hidden" name="policyId" value="")
        input(type="hidden" name="mac" value=device.mac)

  script.
    function selectPolicy(policyId) {
      document.getElementById('loadingOverlay').classList.add('show');
      document.getElementById('policyInput').value = policyId;
      document.getElementById('policyForm').submit();
    }
